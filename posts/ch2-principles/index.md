# 2. 리팩터링 원칙

**목차**

- [2.1 리팩터링 정의](#21-리팩터링-정의)
- [2.2 두 개의 모자](#22-두-개의-모자)
- [2.3 리팩터링하는 이유](#23-리팩터링하는-이유)
- 2.4 언제 리팩터링해야 할까?
- 2.5 리팩터링 시 고려할 문제
- 2.6 리팩터링, 아키텍처, 애그니(YAGNI)
- 2.7 리팩터링과 소프트웨어 개발 프로세스
- 2.8 리팩터링과 성능
- 2.9 리팩터링의 유래
- 2.10 리팩터링 자동화
- 2.11 더 알고 싶다면

## 2.1 리팩터링 정의

- 리팩터링이란 무엇일까? 보편적으로 명사와 동사를 혼용해서 사용한다. 하지만 저자는 명확한 용어 구분을 제안한다.
- 명사 vs. 동사
    - 명사: 동작은 그대로 두고, 이해하기 쉽도록 다듬는 방법
    - 동사: 동작은 그대로 두고, 리팩터링 방법을 적용해 다듬다.
- **리팩터링의 궁극적인 목표는 코드를 이해하여 수정하고 쉽게 만들기다.**

## 2.2 두 개의 모자

> 의도를 명확하게 하자.

- '기능 추가'와 '리팩터링'을 명확히 구분하고 작업하자.
    - 자주 바꿔 쓰자.


## 2.3 리팩터링하는 이유

> No Silver Bullet - Essence and Accident in Software Engineering.

- 리팩터링 또한 소프트웨어 세계의 전반적인 문제를 해결하는 만병통치약이 아니다. 하지만 '건강한 상태 유지'에 적합한 약은 분명하다.

**리팩터링하면 소프트웨어 설계가 좋아진다**

- 리팩터링 하지 않는 코드는 고인 물과 같다. 고인 물이 될 것인가, 흐르는 물이 될 것인가?
- 리팩터링은 복잡한 문제를 해결하기 위한 설계를 지탱한다.
- 작성한 코드 양이 줄어드는 것은 수정할 코드 양도 줄어듬을 의미한다.

**리팩터링하면 소프트웨어를 이해하기 쉬워진다**

- 프로그래밍은 결국 내가 원하는 바를 정확히 표현하는 일이다.
- 코드를 컴파일하는 데 시간이 살짝 더 걸린다고 누가 뭐라 하겠는가? 하지만 다른 프로그래머가 내 코드를 제대로 이해했다면 한 시간에 끝낼 수정을 일주일이나 걸린다면 사정이 달라진다.
- 코드를 이해하기 쉽게 만들려면 일하는 리듬에 변화를 줘야 한다. 잘 작동하지만 이상적인 구조는 아닌 코드가 있다면, 잠깐 시간을 내서 리팩터링해보자. 그러면 코드의 목적이 더 잘 드러나게, 다시 말해 내 의도를 더 명확하게 전달하도록 개선할 수 있다.
- 글을 퇴고하는 이유는 의도를 명확하게 전달하기 위함이다. 리팩터링 또한 그렇다.

**리팩터링하면 버그를 쉽게 찾을 수 있다**

> I'm not a great programmer; I'm just a good programmer with great habits.<br>
> <출처: Kent Beck>

- 코드를 이해하기 쉽다는 말은 버그를 찾기 쉽다는 말이기도 하다.
- 프로그램의 구조를 명확하게 다듬으면 그냥 '이럴 것이다'라고 가정하던 점들이 분명히 드러나는데, 버그를 지나치려야 지나칠 수 없을 정도까지 명확해진다.
- 리팩터링은 견고한 코드를 작성하는 데 무척 효과적이다.

**리팩터링하면 프로그래밍 속도를 높일 수 있다**

- **설계는 고정되지 않는다. 유연하게 변화한다. 리팩터링은 지속해서 설계를 개선하는 방법이다.**
- 리팩터링하면 코드 개발 속도를 높일 수 있다.
- 내부 설계가 잘 된 소프트웨어는 새로운 기능을 추가할 지점과 어떻게 고칠지를 쉽게 찾을 수 있다. 
- 모듈화가 잘 되어 있으면 전체 코드베이스 중 작은 일부만 이해하면 된다.
- 코드가 명확하면 버그를 만들 가능성도 줄고, 버그를 만들더라도 디버깅하기가 훨씬 쉽다. 
- 내부 품질이 뛰어난 코드베이스는 새 기능 구축을 돕는 견고한 토대가 된다.
- 지구력 가설(Design Stamina Hypothesis), 내부 설계에 심혈을 기울이면 소프트웨어 지구력이 높아져서 빠르게 개발할 수 있는 상태를 더 오래 지속할 수 있다.
- 처음부터 좋은 설계를 마련하기란 매우 어렵다. 그래서 빠른 개발이라는 숭고한 목표를 달성하려면 리팩터링이 반드시 필요하다.

<참고 자료>

- [Martin Fowler 'Design Stamina Hypothesis'](https://martinfowler.com/bliki/DesignStaminaHypothesis.html)

## 2.4 언제 리팩터링해야 할까?

> 3의 법칙 <출처: Don Roberts>
> 
> 1. 처음에는 그냥 한다.
> 2. 비슷한 일을 두 번째로 하게 되면(중복이 생겼다는 사실에 당황스럽겠지만), 일단 계속 진행한다.
> 3. 비슷한 일을 세 번째 하게 되면 리팩터링한다.

**준비를 위한 리팩터링: 기능을 쉽게 추가하게 만들기**

- **말이 아닌, 변화에 유연하게 대응할 수 있는 '상황'을 만들자.**
- 리팩터링하기 가장 좋은 시점은 코드베이스에 기능을 새로 추가하기 직전이다. 이 시점에 현재 코드를 살펴보면서, 구조를 살짝 바꾸며 다른 작업을 하기가 훨씬 쉬워질 만한 부분을 찾는다.
- 오류를 일으키는 코드가 세 곳에 복제되어 퍼져 있다면, 우선 한 곳으로 합치는 편이 작업하기에 훨씬 편하다. 또는 질의 코드에 섞여 있는 갱신 로직을 분리하면 두 작업이 꼬여서 생기는 오류를 크게 줄일 수 있다.

<참고 자료>

- [Martin Fowler 'An example of preparatory refactoring'](https://martinfowler.com/articles/preparatory-refactoring-example.html)
